---
layout: post
title: "HTTP简介"
date: 2019-04-04 08:55
comments: false
tags: 
- 网络
categories:	
- 基础
- 网络
---

本文简单介绍HTTP协议。

<!--more-->


### HTTP 协议基础

#### 定义
HTTP（全称超文本传输协议，英文全称HyperText Transfer Protocol），属于应用层协议，底层是靠TCP进行可靠地信息传输。

#### HTTP报文

HTTP报文分为2部分：
* 报文首部：服务端或客户端需处理的请求或响应的内容或属性
  * 请求报文中，由**请求行**和**首部字段**组成
  * 响应报文中，由**状态行**和**首部字段**组成
* 报文主体：应被发送的数据



##### 请求报文
<img height=400 src="/assets/blogImg/NetWork_Basic/HTTP/1.png">

<img height=400 src="/assets/blogImg/NetWork_Basic/HTTP/2.png">

##### 响应报文
<img height=400 src="/assets/blogImg/NetWork_Basic/HTTP/3.png">

<img height=400 src="/assets/blogImg/NetWork_Basic/HTTP/4.png">


#### 首部字段
使用首部字段是为了给客服端和服务器端提供报文主体大小、所使用的语言、认证信息等内容。

##### 首部字段结构
HTTP 首部字段是由首部字段名和字段值构成的，中间用冒号“：”分隔。

##### 首部字段类型

类型 | 描述 | 举例
---|--- | ---
通用首部 | 请求报文和响应报文都会使用的首部 | Date、Transfer-Encoding
请求首部 | 补充请求的附加内容、客户端信息、响应内容相关优先级等信息 | Accept-Charset、Host、If-Match
响应首部 | 补充响应的附加内容 | ETag、Location
实体首部 | 补充资源内容更新时间等与实体有关的信息 | Content-Encoding、Content-Length


#### Cookie问题

##### 背景
<font color=orange>**HTTP 是一种无状态协议**</font>。但为了支持业务对通信状态的保持，引入 Cookie 技术。

##### 相关的首部字段

名称 | 说明 | 类型
---|---|---
Set-Cookie | 开始状态管理所使用的Cookie信息 | 响应首部字段
Cookie | 服务端收到的Cookie信息 | 请求首部字段

##### 流程
Cookie 技术通过在请求和响应报文中写入 Cookie 信息来控制客户端的状态：
* 服务器端发送的响应报文内，使用`Set-Cookie`通知客户端保存Cookie
* 客户端再往该服务器发送请求时，客户端会自动在请求报文中加入 Cookie 值后发送出去。
* 服务器端发现客户端发送过来的 Cookie 后，根据服务器上的记录，最后得到之前的状态信息。

<img height=400 src="/assets/blogImg/NetWork_Basic/HTTP/5.png">


#### 持久连接
HTTP 协议的初始版本中，每进行一个 HTTP 通信都要断开一次 TCP 连接。

为了解决上述 TCP 连接的问题，HTTP/1.1 和部分 HTTP/1.0 想出了持久连接的方法。其特点是，只要任意一端没有明确提出断开连接，则保持 TCP 连接状态。旨在建立一次 TCP 连接后进行多次请求和响应的交互。在 HTTP/1.1 中，所有的连接默认都是持久连接。


### HTTPS 简介
简单的说：<font color=red>**Http + 加密 + 认证 + 完整性保护 = Https**</font>。

#### Https的加密原理
近代密码学中加密的方式主要有两类:
* 对称秘钥加密：
  * 加密与解密过程使用同一把秘钥
  * 处理速度快
  * 如何安全的从一方将秘钥传递到通信的另一方是一个问题
* 非对称秘钥加密
  * 指加密与解密使用两把不同的秘钥
  * 公开秘钥：可以随意对外公开
  * 私有秘钥：只用于本身持有
  * 得到公开秘钥的客户端可以使用公开秘钥对传输内容进行加密，而只有私有秘钥持有者本身可以对公开秘钥加密的内容进行解密。
  * 克服了秘钥交换的问题，但是相对处理速度较慢
 
于是，Https的加密原理是：<font color=green>SSL\TLS的加密方式则是结合了两种加密方式的优点。首先采用非对称秘钥加密，将一个对称秘钥使用公开秘钥加密后传输到对方。对方使用私有秘钥解密，得到传输的对称秘钥。之后双方再使用对称秘钥进行通信。这样即解决了对称秘钥加密的秘钥传输问题，又利用了对称秘钥的高效率来进行通信内容的加密与解密</font>。

#### Https的认证
SSL\TLS采用的混合加密的方式还是存在一个问题，即怎么样确保用于加密的公开秘钥确实是所期望的服务器所分发的呢？也许在收到公开秘钥时，这个公开秘钥已经被别人篡改了。因此，我们还需要对这个秘钥进行认证的能力，以确保我们通信的对方是我们所期望的对象。

目前的做法是使用由数字证书认证机构颁发的公开秘钥证书。服务器的运营人员可以向认证机构提出公开秘钥申请。认证机构在审核之后，会将公开秘钥与共钥证书绑定。服务器就可以将这个共钥证书下发给客户端，客户端在收到证书后，使用认证机构的公开秘钥进行验证。一旦验证成功，即可知道这个秘钥是可以信任的秘钥。

#### Https的通信流程
<img height=400 src="/assets/blogImg/NetWork_Basic/HTTP/6.png">

流程如下：
* Client发起请求
* Server端响应请求，并将证书发送至Client
* Client使用认证机构的公钥解密证书，并从证书中取出Server端公钥
* Client使用公钥加密一个随机秘钥，并传到Server
* Server使用私钥解密出随机秘钥
* 通信双方使用随机秘钥最为对称秘钥进行加密解密

